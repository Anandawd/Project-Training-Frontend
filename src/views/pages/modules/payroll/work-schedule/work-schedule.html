<section class="content">
  <div class="container-fluid">
    <!-- button insert -->
    <div class="d-flex justify-content-end mb-2">
      <button
        disabled
        title="Export Schedule"
        type="button"
        class="btn btn-secondary mr-1"
        @click="handleShowForm('', $global.modePayroll.export)"
      >
        <i class="fa fa-file-export mr-1" aria-hidden="true"></i>{{
        $t('buttons.export')}}
      </button>
      <button
        title="Switch Schedule"
        type="button"
        class="btn btn-primary mr-1"
        @click="handleShowModal('', $global.modePayroll.switchSchedule)"
      >
        <i class="fa fa-exchange-alt mr-1" aria-hidden="true"></i>{{
        $t('buttons.switchSchedule') }}
      </button>
      <button
        title="Insert Schedule"
        type="button"
        class="btn btn-primary mr-1"
        @click="handleShowForm('', $global.modeData.insert)"
      >
        <i class="fa fa-plus mr-1" aria-hidden="true"></i>{{
        $t('buttons.insert') }}
      </button>
    </div>

    <!-- insert form -->
    <transition name="fade">
      <c-input-form
        class="px-2"
        ref="inputFormElement"
        v-show="showForm"
        :schema="schema"
        :modeData="modeData"
        :employeeOptions="employeeOptions"
        :workScheduleOptions="workScheduleOptions"
        :workScheduleTypeOptions="workScheduleTypeOptions"
        @save="handleSave"
        @close="showForm=false"
      />
    </transition>

    <!-- filter -->
    <c-search-filter
      date-range
      :options="searchOptions"
      :searchDefault="searchDefault"
      @search="refreshData"
    >
    </c-search-filter>

    <!-- Weekly Schedule View -->
    <div class="card mb-4">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h3 class="card-title mb-0">
            {{$t('title.weeklySchedule')}} : {{currentWeekRange}}
          </h3>
          <div class="week-navigation">
            <button
              type="button"
              class="btn btn-sm btn-outline-secondary mx-1"
              @click="navigateWeek(-1)"
              :title="$t('buttons.previousWeek')"
            >
              <i class="fa fa-chevron-left mx-1" aria-hidden="true"></i>{{
              $t('buttons.prevWeek')}}
            </button>
            <button
              type="button"
              class="btn btn-sm btn-primary week-nav-btn mx-1"
              @click="goToCurrentWeek"
              :title="$t('buttons.currentWeek')"
            >
              <i class="fa fa-calendar-day mr-1" aria-hidden="true"></i>
              {{$t('buttons.thisWeek')}}
            </button>
            <button
              type="button"
              class="btn btn-sm btn-outline-secondary week-nav-btn mx-1"
              @click="navigateWeek(1)"
              :title="$t('buttons.nextWeek')"
            >
              {{ $t('buttons.nextWeek')}}
              <i class="fa fa-chevron-right ml-1" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-bordered table-hover schedule-table">
            <thead class="table-light">
              <tr>
                <th style="width: 100px">
                  {{$t('labels.payroll.employee.id')}}
                </th>
                <th style="width: 120px">
                  {{$t('labels.payroll.employee.name')}}
                </th>
                <th style="width: 100px">
                  {{$t('labels.payroll.employee.department')}}
                </th>
                <th
                  v-for="(day, index) in weekDays"
                  :key="index"
                  class="text-center"
                  style="width: 100px"
                >
                  <div class="day-header">
                    <strong>{{ day.name }}</strong>
                    <br />
                    <small class="text-muted">{{day.date}}</small>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr
                v-for="(employee, empIndex) in currentWeekData"
                :key="empIndex"
                class="employee-row"
              >
                <td class="align-middle">
                  <strong>{{employee.employee_id}}</strong>
                </td>
                <td class="align-middle">
                  <div>
                    <strong>{{employee.employee_name}}</strong>
                    <br />
                    <small class="text-muted"
                      >{{employee.work_schedule_name}}</small
                    >
                  </div>
                </td>
                <td class="align-middle">
                  <small>{{employee.department_name}}</small>
                </td>
                <td
                  v-for="(day, dayIndex) in weekDays"
                  :key="dayIndex"
                  @click="selectedSchedule(employee, dayIndex)"
                  class="shift-cell text-center align-middle"
                >
                  <span
                    :class="{
                      'shift-badge': true,
                      'morning': getScheduleCode(employee.employee_id, dayIndex) === 'M',
                      'evening': getScheduleCode(employee.employee_id, dayIndex) === 'E',
                      'night': getScheduleCode(employee.employee_id, dayIndex) === 'N',
                      'regular': getScheduleCode(employee.employee_id, dayIndex) === 'R',
                      'flexible': getScheduleCode(employee.employee_id, dayIndex) === 'F',
                      'off': getScheduleCode(employee.employee_id, dayIndex) === 'OFF',
                      'split': getScheduleCode(employee.employee_id, dayIndex) === 'SP'
                      }"
                    >{{getScheduleCode(employee.employee_id, dayIndex)}}
                  </span>
                  <div class="shift-time">
                    <small>
                      {{getScheduleTime(employee.employee_id, dayIndex)}}
                    </small>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- legend -->
        <div class="mt-4 card border-info">
          <div class="card-header bg-light">
            <h6 class="mb-0">
              <i class="fa fa-info-circle mr-2"></i>
              {{$t('labels.payroll.attendance.legend')}}
            </h6>
          </div>
          <div class="card-body">
            <div class="d-flex flex-wrap">
              <div class="me-4 mb-2">
                <span class="badge bg-primary">R</span> - Regular (08:00-17:00)
              </div>
              <div class="me-4 mb-2">
                <span class="badge bg-info">F</span> - Flexible (09:00-18:00)
              </div>
              <div class="me-4 mb-2">
                <span class="badge bg-success">M</span> - Morning (06:00-15:00)
              </div>
              <div class="me-4 mb-2">
                <span class="badge bg-warning">E</span> - Evening (14:00-23:00)
              </div>
              <div class="me-4 mb-2">
                <span class="badge bg-dark">N</span> - Night (23:00-07:00)
              </div>
              <div class="me-4 mb-2">
                <span class="badge bg-secondary">OFF</span> - Day Off
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Weekly Schedule Table -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">{{$t('title.employeeSchedule')}}</h3>
      </div>
      <div class="card-body">
        <ag-grid-vue
          :style="agGridSetting.styleAgGridFrame"
          :class="agGridSetting.themeAgGrid"
          :columnDefs="columnDefs"
          :rowData="rowData"
          :paginationPageSize="paginationPageSize"
          :gridOptions="gridOptions"
          :context="context"
          :frameworkComponents="frameworkComponents"
          :enableCellChangeFlash="true"
          :rowSelection="rowSelection"
          :getContextMenuItems="getContextMenu"
          :defaultColDef="agGridSetting.defColDef"
          :rowGroupPanelShow="rowGroupPanelShow"
          :suppressDragLeaveHidesColumns="true"
          :suppressMakeColumnVisibleAfterUnGroup="true"
          :statusBar="statusBar"
          @grid-ready="onGridReady"
          @cellContextMenu="handleRowRightClicked"
        ></ag-grid-vue>
      </div>
    </div>

    <!-- Switch Schedule -->
    <c-modal
      v-show="showModal"
      :title="$t('title.switchSchedule')"
      size="lg"
      @close="showModal = false"
      @save="handleSaveModal"
    >
      <div @click.stop>
        <!-- document modal -->
        <c-form
          ref="inputFormModalRef"
          :validation-schema="modalValidationSchema"
          @submit="handleSaveModal"
          class="row"
        >
          <!-- select employee -->
          <div class="row mb-3">
            <div class="col-md-6">
              <c-select
                required
                offset="right"
                class="row mb-1"
                selectType="column"
                name="SelectEmployee"
                labelName="name"
                keyName="employee_id"
                v-model="modalForm.employee_id"
                :label="$t('labels.payroll.attendance.selectEmployee')"
                :columnOptions="columnEmployeeOptions"
                :options="employeeOptions"
                @change="onEmployeeChange"
                :disabled="modeData === $global.modeData.edit"
                validate
              >
              </c-select>
            </div>
            <div class="col-md-6">
              <c-input
                disabled
                type="text"
                name="Department"
                id="Department"
                class="row mb-1"
                :label="$t('labels.payroll.employee.department')"
                v-model="modalForm.department_name"
              />
            </div>
            <div class="col-md-6">
              <c-input
                disabled
                name="Position"
                id="Position"
                class="row mb-1"
                type="text"
                v-model="modalForm.position_name"
                :label="$t('labels.payroll.employee.position')"
              />
            </div>
            <div class="col-md-6">
              <c-input
                disabled
                name="Placement"
                id="Placement"
                class="row mb-1"
                type="text"
                v-model="modalForm.placement_name"
                :label="$t('labels.payroll.employee.placement')"
              />
            </div>
            <div class="col-md-6">
              <c-select
                offset="right"
                class="row mb-1"
                name="CurrentSchedule"
                labelName="name"
                keyName="employee_id"
                v-model="modalForm.work_schedule_name"
                :label="$t('labels.payroll.attendance.currentSchedule')"
                @change="onEmployeeChange"
                validate
              >
              </c-select>
            </div>
            <div class="col-md-6">
              <c-select
                required
                offset="right"
                class="row mb-1"
                selectType="column"
                name="SelectEmployee"
                labelName="name"
                keyName="employee_id"
                v-model="modalForm.new_schedule_code"
                :label="$t('labels.payroll.attendance.newSchedule')"
                :columnOptions="columnOptions"
                :options="workScheduleOptions"
                validate
              >
              </c-select>
            </div>
            <div class="col-md-6">
              <c-input
                type="textarea"
                name="Reason"
                id="Reason"
                class="row mb-1"
                :label="$t('labels.payroll.attendance.switchReason')"
                v-model="modalForm.reason"
              />
            </div>
          </div>

          <!-- <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label"
                >{{$t('labels.payroll.attendance.currentSchedule')}}</label
              >
              <div class="current-shift-display">
                <span
                  :class="{
            'badge rounded-pill px-3 py-2': true,
            'bg-primary': modalForm.current_schedule === 'R',
            'bg-info': modalForm.current_schedule === 'F',
            'bg-success': modalForm.current_schedule === 'M',
            'bg-warning': modalForm.current_schedule === 'E',
            'bg-dark': modalForm.current_schedule === 'N',
            'bg-secondary': modalForm.current_schedule === 'OFF'
          }"
                >
                  {{getScheduleName(modalForm.employee_id,
                  modalForm.day_index)}}
                </span>
              </div>
            </div>
            <div class="col-md-6">
              <label class="form-label"
                >{{$t('labels.payroll.attendance.newSchedule')}}</label
              >
              <select class="form-control" v-model="newScheduleCode">
                <option
                  v-for="schedule in workScheduleOptions"
                  :key="schedule.code"
                  :value="schedule.code"
                >
                  {{schedule.name}}
                </option>
              </select>
            </div>
          </div> -->
        </c-form>

        <!-- button -->
        <div class="d-flex justify-content-end mt-2">
          <button
            type="button"
            n
            class="btn btn-danger mr-1 px-3"
            @click="showModal = false"
          >
            <i class="fa fa-times" aria-hidden="true"></i>
            {{$t('buttons.cancel')}}
          </button>
          <button
            type="button"
            class="btn btn-primary px-3"
            @click="handleSaveModal"
            :disabled="!newScheduleCode"
          >
            <i class="fa fa-save mr-1"></i>
            {{$t('buttons.save')}}
          </button>
        </div>
      </div>
    </c-modal>

    <!-- dialog -->
    <c-dialog
      v-show="showDialog"
      dialogTitle="Confirm"
      size="sm"
      @confirm="confirmAction"
      @cancel="showDialog=false"
    >
      <template #body>{{dialogMessage}}</template>
    </c-dialog>
  </div>
</section>
